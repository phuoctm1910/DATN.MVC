@model DATN.MVC.Respone.MarketPlace.GetALLProductAndCategory
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Shopee</title>
    <link rel="icon" href="/assets/img/logo/shopee-logo.png" type="image/x-icon">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/normalize/8.0.1/normalize.min.css">
    <link rel="stylesheet" href="/assets/css/style.css">
    <link rel="stylesheet" href="/assets/css/category.css">
    <link rel="stylesheet" href="/assets/css/grid.css">
    <link rel="stylesheet" href="/assets/css/responsive.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <link href="https://fonts.googleapis.com/css?family=Roboto&display=swap" rel="stylesheet" />
    <link rel="stylesheet" href="/assets/fonts/fontawesome-free-5.12.1-web/css/all.min.css" />

</head>
<body>
    <!-- main -->
    <div class="app">
        <!-- header -->
        <header class="header" style="color: ">
            <div class="grid wide">
                <!-- navbar -->
                <nav class="header__navbar hide-on-mobile-tablet">
                </nav>
                <!-- search -->
                <div class="header__contain">
                    <label for="mobile-search" class="header__mobile-search">
                        <i class="header__mobile-search-icon fas fa-search"></i>
                    </label>
                    <div class="header__logo">
                        <a href="#" class="header__logo-link">
                          
                        </a>
                    </div>
                    <input type="checkbox" id="mobile-search" class="header__search-check" hidden>
                  
                        <form action="@Url.Action("SearchByName", "MarketPlace")" method="get" class="header__search">
                            <div class="header__search-input-wrap">
                                <input type="text" name="searchTerm" class="header__search-input" placeholder="Tìm kiếm sản phẩm..." value="@ViewBag.SearchTerm">
                            </div>
                            <button type="submit" class="btn header__search-btn">
                                <i class="header__search-btn-icon fas fa-search"></i>
                            </button>
                        </form>
                    <div class="header__cart header__cart--has-cart">
                    </div>
                </div>
            </div>
           
        </header>

        <div class="box-category">
            <div class="categories">
                <h2>DANH MỤC</h2>
                <div class="category-slider">
                    <div class="category-list">
                        @foreach (var category in Model.Categories)
                        {
                            <div class="category-item" onclick="window.location.href='@Url.Action("FilterByCategory", "MarketPlace", new { categoryId = category.Id })';" style="cursor: pointer;">
                                <img src="/assets/img/ImageCategory/@category.Image" alt="@category.Name" />
                                <p>@category.Name</p>
                            </div>
                        }

                    </div>
                </div>
            </div>
            <div class="styleFont-angle-left noAcctive-category" id="angle-left">
                <i class="pagination-item__icon fas fa-angle-left"></i>
            </div>
            <div class="styleFont-angle-right " id="angle-right">
                <i class="pagination-item__icon fas fa-angle-right"></i>
            </div>
        </div>

        <div class="custom-grid wide">
            <div class="custom-row sm-gutter app__content">
                <div>
                    <div class="title">
                        <h2>CÁC GIAN HÀNG</h2>
                    </div>
                    <!-- Product -->
                    <div class="home-product">
                        <div class="box-list-product">
                            <div class="custom-row sm-gutter list-product slick-slider">
                        
                                @foreach (var saleplace in Model.salePlace)
                                {
                                    <div class="col l-2-4 m-4 c-6 product-item">
                                        <a href="@Url.Action("SalePlace", "Marketplace", new { saleplace = saleplace.Id })" class="home-product-item">
                                            <div class="shop-info-left-id">
                                                <img src="/assets/img/ImageSalePlace/@saleplace.Image" alt="" class="img-fluid">
                                            </div>

                                            <div class="home-product-item__price">
                                                <span class="home-product-item__price-current">@saleplace.Name</span>
                                            </div>
                                        </a>
                                    </div>
                                }
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="">
            <div class="grid wide">
                <div class="row sm-gutter">
                    <div class="col l-2 m-0 c-0">
                        <!-- category -->
                        <nav class="category">
                            <h3 class="category-heading">
                                <i class="category-heading-icon fas fa-list-ul"></i>
                                Bộ lọc tìm kiếm
                            </h3>
                            <div class="category-group">
                                <div class="category-group-title">Khoảng Giá</div>
                                <form action="@Url.Action("FilterByPrice", "MarketPlace")" method="get">
                                    <div class="category-group-filter">
                                        <input type="number" name="minPrice" id="minPrice" placeholder="đ Từ" class="category-group-filter-input">
                                        <i class="fas fa-arrow-right"></i>
                                        <input type="number" name="maxPrice" id="maxPrice" placeholder="đ Đến" class="category-group-filter-input">
                                    </div>
                                    <button type="submit" class="btn btn--primary category-group-filter-btn">Áp dụng</button>
                                </form>
                            </div>
                            <script>
                                function formatNumberWithCommas(value) {
                                    return value.replace(/\B(?=(\d{3})+(?!\d))/g, '.');
                                }

                                document.getElementById('minPrice').addEventListener('input', function (e) {
                                    let inputValue = e.target.value.replace(/\./g, ''); // Loại bỏ dấu chấm cũ
                                    e.target.value = formatNumberWithCommas(inputValue);
                                });

                                document.getElementById('maxPrice').addEventListener('input', function (e) {
                                    let inputValue = e.target.value.replace(/\./g, ''); // Loại bỏ dấu chấm cũ
                                    e.target.value = formatNumberWithCommas(inputValue);
                                });

                            </script>
                        </nav>
                    </div>
                    <div class="col l-10 m-12 c-12">
                        <!-- home filter -->
                        <div class="home-filter hide-on-mobile-tablet">
                            <div class="home-filter-control"> 
                                <a href="@Url.Action("SortProducts", "MarketPlace", new { sortOrder = "newest" })" class="btn btnSuccess">Mới nhất</a>



                                <a href="/MarketPlace/SortProducts?sortOrder=asc" class="btn btnSuccess">Sắp xếp giá tăng dần</a>
                                <a href="/MarketPlace/SortProducts?sortOrder=desc" class="btn btnSuccess">Sắp xếp giá giảm dần</a>
                           
                               
                            </div>
                            <div class="home-filter-page">
                                <div class="home-filter-page-number">
                          
                                </div>
                                <div class="home-filter-page-control">
                            
                                </div>
                            </div>
                        </div>
                        <!-- home product -->
                        <div class="home-product">
                            <div id="list-product" class="row sm-gutter">
                                @if (!string.IsNullOrEmpty(ViewBag.SearchTerm))
                                {
                                    <p>Kết quả tìm kiếm cho: <strong>@ViewBag.SearchTerm</strong></p>
                                }
                                @if (Model.Products == null || !Model.Products.Any())
                                {
                                    <p>Không có sản phẩm nào.</p>

                                }
                                else
                                {
                                    @foreach (var product in Model.Products)
                                    {
                                        <div class="col l-2 m-3 c-6 home-product-item">
                                            <a class="home-product-item-link" href="#">
                                                <div class="home-product-item__img" style="background-image: url(/assets/img/home/20.PNG);"></div>
                                                <div class="home-product-item__info">
                                                    <h4 class="home-product-item__name">@product.Name</h4>
                                                    <div class="home-product-item__price">

                                                        <p class="home-product-item__price-new">@product.Price đ</p>
                                                        <i class="home-product-item__ship fas fa-shipping-fast"></i>
                                                    </div>
                                                    <div class="home-product-item__origin">@product.CategoryName</div>


                                                </div>
                                            </a>
                                            <button class="home-product-item-footer">LIÊN HỆ SHOP</button>

                                        </div>
                                    }
                                }

                            </div>
                        </div>
                        @{
                            var currentPage = ViewBag.Page ?? 1;  // Gán mặc định là 1 nếu null
                            var totalPages = ViewBag.TotalPages ?? 1;  // Gán mặc định là 1 nếu null
                            var startPage = ViewBag.StartPage ?? 1;  // Gán mặc định là 1 nếu null
                            var endPage = ViewBag.EndPage ?? totalPages;  // Gán giá trị cuối cùng nếu null
                        }

                     
                        </div>

                    
                    <ul class="pagination home-product-pagination">
                        @if (currentPage > 1)
                        {
                            <li class="pagination-item">
                                <a href="@Url.Action("SearchByName", "MarketPlace", new { searchTerm = ViewBag.SearchTerm, page = 1, pageSize = ViewBag.PageSize })" class="pagination-item-link">Đầu</a>
                            </li>
                        }

                        @for (int i = startPage; i <= endPage; i++)
                        {
                            <li class="pagination-item @(currentPage == i ? "pagination-item--active" : "")">
                                <a href="@Url.Action("SearchByName", "MarketPlace", new { searchTerm = ViewBag.SearchTerm, page = i, pageSize = ViewBag.PageSize })" class="pagination-item-link">@i</a>
                            </li>
                        }

                        @if (currentPage < totalPages)
                        {
                            <li class="pagination-item">
                                <a href="@Url.Action("SearchByName", "MarketPlace", new { searchTerm = ViewBag.SearchTerm, page = totalPages, pageSize = ViewBag.PageSize })" class="pagination-item-link">Cuối</a>
                            </li>
                        }
                    </ul>




                    
                    </div>
                </div>
            </div>
        </div>
        <footer class="">
        </footer>
    </div>
    <!-- script js -->
    <script src="/assets/js/product.js"></script>
    <script src="/assets/js/category.js"></script>
    <script>
        // Kéo trượt danh sách sản phẩm
        const row = document.querySelector('.list-product');

        let isDragging = false;
        let startX;
        let currentRowPosition = 0; // Đổi tên biến
        const maxScroll = row.scrollWidth - row.clientWidth;

        // Lắng nghe sự kiện mousedown (bắt đầu kéo)
        row.addEventListener('mousedown', (e) => {
            isDragging = true;
            startX = e.pageX - row.offsetLeft;
            row.style.cursor = 'grabbing';
        });

        // Lắng nghe sự kiện mousemove (đang kéo)
        row.addEventListener('mousemove', (e) => {
            if (!isDragging) return;
            const moveX = e.pageX - row.offsetLeft;
            const distance = startX - moveX;

            currentRowPosition += distance;
            if (currentRowPosition < 0) currentRowPosition = 0;
            if (currentRowPosition > maxScroll) currentRowPosition = maxScroll;

            row.style.transform = `translateX(-${currentRowPosition}px)`;
            startX = moveX;
        });

        // Lắng nghe sự kiện mouseup và mouseleave
        row.addEventListener('mouseup', () => {
            isDragging = false;
            row.style.cursor = 'grab';
        });

        row.addEventListener('mouseleave', () => {
            isDragging = false;
            row.style.cursor = 'grab';
        });
    </script>
</body>
</html>