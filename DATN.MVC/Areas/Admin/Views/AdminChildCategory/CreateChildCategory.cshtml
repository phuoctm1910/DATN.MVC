@section Scripts {
    <script>
        $(document).ready(function () {
            $('#createCategoryForm').submit(function (e) {
                e.preventDefault();

                // Reset error messages
                $('#NameError').text('');
                $('#ParentCategoryIdError').text('');
                $('#ErrorContainer').hide();

                // Lấy giá trị CategoryName và ParentCategoryId
                var name = $('#Name').val().trim();
                var parentCategoryId = $('#ParentCategoryId').val();

                // Kiểm tra nếu CategoryName rỗng
                if (!name) {
                    $('#NameError').text('Tên danh mục không được để trống.');
                    return; // Dừng nếu không hợp lệ
                }

                // Kiểm tra nếu ParentCategoryId chưa được chọn
                if (!parentCategoryId) {
                    $('#ParentCategoryIdError').text('Vui lòng chọn danh mục cha.');
                    return; // Dừng nếu không hợp lệ
                }

                // Chuẩn bị dữ liệu gửi đến API
                var categoryData = {
                    ParentCategoryId: parentCategoryId, // ID danh mục cha
                    CategoryName: name                 // Tên danh mục con
                };
                    
                // Thêm trạng thái đang xử lý cho nút
                var submitButton = $(this).find('button[type="submit"]');
                submitButton.prop('disabled', true).text('Đang xử lý...');

                // Gửi dữ liệu qua AJAX
                $.ajax({
                    url: 'https://localhost:7296/CreateChildCategory', // Thêm dấu phẩy ở cuối dòng
                    type: 'POST',
                    contentType: 'application/json',
                    data: JSON.stringify(categoryData),
                    success: function () {
                        alert('Thêm danh mục con thành công');
                        window.location.href = '@Url.Action("Index", "AdminChildCategory")'; // Chuyển hướng sau khi thêm thành công
                    },
                    error: function (xhr) {
                        var errorMessage = xhr.responseJSON?.message || 'Có lỗi xảy ra khi thêm danh mục.';
                        $('#ErrorContainer').text(errorMessage).show();
                        console.error('Error Details:', xhr);
                    },
                    complete: function () {
                        // Khôi phục nút sau khi xử lý
                        submitButton.prop('disabled', false).text('Create');
                    }
                });
            });
        });
    </script>
}




<h2>Thêm Danh Mục Con</h2>

<form id="createCategoryForm" method="post" class="form-container">
    <div class="form-group">
        <label for="ParentCategoryId">Chọn danh mục cha:</label>
        <select id="ParentCategoryId" name="ParentCategoryId" class="form-control" required>
            <option value="">-- Chọn danh mục cha --</option>
            @if (ViewBag.ParentCategories != null)
            {
                foreach (var category in ViewBag.ParentCategories)
                {
                    <option value="@category.Id">@category.Name</option>
                }
            }
        </select>
        <span id="ParentCategoryIdError" class="error-message"></span>
    </div>

    <div class="form-group">
        <label for="Name">Tên danh mục con:</label>
        <input type="text" id="Name" name="Name" class="form-control" required />
        <span id="NameError" class="error-message"></span>
    </div>

    <button type="submit" class="btn btn-primary">Create</button>
</form>

<div id="ErrorContainer" class="alert alert-danger" style="display:none;"></div>
